#!/usr/local/bin/perl

#----------------------------------------------------#
# WebPatio                                           #
# JavaScript設定値難読化スクリプト 出力CGIプログラム #
#----------------------------------------------------#

use lib qw(../lib ../lib/perl5);
use JavaScript::Packer;
use Encode;

require '../init.cgi';

my $js = "var c=function(a){if(\"TkdJRA==\"===a)return{ngres_message:\"${ngres_comment}\",chain_ng:".($chain_ng?'true':'false').",use_ngid:".(($ngid&&$idkey)?'true':'false').",ngid_cookie_limit_reached_error_message:\"${ngid_error_message}\",use_ngname:".($ngname?'true':'false').",ngname_cookie_limit_reached_error_message:\"${ngname_error_message}\",ngname_display_characters:${ngname_dispchar_length},cookie_current_dirpath:\"${cookie_current_dirpath}\"};if(\"UmVmUmVz\"===a)return{ngres_hide_reference_counter:".($ngres_hide_refcounter?'true':'false').",number_of_anchor_made_ref_count_exempt:${number_of_anchor_made_ref_count_exempt}};if(\"UmVhZFVwVG9IZXJl\"===a)return{endpoint_url:\"$readapicgi\",history_url:\"$readup_to_here_added_history_link_url\",not_login_error_link_url:\"$readup_to_here_not_login_error_link_url\"};if(\"VGhyZWFkTnVtL05hbWVBdXRvUHJvaGliaXRpbmc=\"===a)return{endpoint_url:\"$readapicgi\"}};";
$js = decode('cp932', $js);

my $packer = JavaScript::Packer->init();
$packer->minify(\$js, {compress => 'obfuscate'});

$js = encode('cp932', $js);
print "Content-type: text/javascript; charset=shift_jis\n\n$js";
